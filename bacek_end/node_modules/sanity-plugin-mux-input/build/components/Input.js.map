{"version":3,"sources":["../../src/components/Input.js"],"names":["NOOP","cachedSecrets","token","secretKey","enableSignedUrls","signingKeyId","signingKeyPrivate","validateSecrets","secrets","getSecrets","Promise","resolve","isInitialSetup","needsSetup","then","exists","MuxVideoInput","Component","constructor","props","assetDocument","confirmRemove","deleteOnMuxChecked","deleteAssetDocumentChecked","error","hasFocus","isLoading","isSigned","showSetup","showBrowser","videoReadyToPlay","thumbLoading","handleFocus","setState","state","pollInterval","setInterval","assetId","response","data","client","patch","_id","set","status","commit","returnDocuments","catch","event","prevState","showStetup","result","onChange","PatchEvent","from","asset","_ref","document","setupAssetListener","preventDefault","stopPropagation","unsetAsset","reject","unset","delete","videoPlayer","current","currentTime","getVideoElement","options","time","thumbTime","width","height","fitMode","thumb","playbackId","newThumb","value","setupButton","React","createRef","video","removeVideoButton","componentDidMount","componentWillUnmount","subscription","unsubscribe","clearInterval","getAsset","pipe","handleRemoveVideo","Error","errors","messages","join","static_renditions","pollMux","config","mp4_support","playback_ids","policy","subscribe","renderSetup","handleCancelSaveSetup","handleSaveSetup","renderSetupButton","styles","setupButtonContainer","handleSetupButtonClicked","SetupIcon","renderSetupNotice","backgroundColor","borderRadius","renderAsset","isSignedAlert","handleVideoReadyToPlay","renderVideoButtons","readOnly","handleBrowseButton","handleOpenThumb","handleRemoveVideoButtonClicked","renderBrowser","handleCloseBrowser","handleSelectAsset","renderError","handleErrorClose","message","render","type","level","markers","cssAspectRatio","aspect_ratio","split","studioTheme","position","title","description","formField","blur","focus","handleOnUploadComplete","handleCloseThumbPreview","maxWidth","display","aspectRatio","handleSetThumbButton","handleCancelRemove","handleDeleteOnMuxCheckBoxClicked","margin","handleDeleteAssetDocumentCheckBoxClicked"],"mappings":";;;;;;;AAAA;;AAcA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;AAEA,IAAMA,IAAI,GAAG,MAAM;AACjB;AACD,CAFD;;AAIA,IAAMC,aAAa,GAAG;AACpBC,EAAAA,KAAK,EAAE,IADa;AAEpBC,EAAAA,SAAS,EAAE,IAFS;AAGpBC,EAAAA,gBAAgB,EAAE,KAHE;AAIpBC,EAAAA,YAAY,EAAE,IAJM;AAKpBC,EAAAA,iBAAiB,EAAE;AALC,CAAtB;;AAQA,SAASC,eAAT,CAAyBC,OAAzB,EAAkC;AAChC,MAAI,CAACA,OAAO,CAACN,KAAT,IAAkB,CAACM,OAAO,CAACL,SAA/B,EAA0C,OAAO,KAAP;AAE1C,SAAO,IAAP;AACD;;AAED,SAASM,UAAT,GAAsB;AACpB,MAAIR,aAAa,CAACC,KAAlB,EAAyB;AACvB,WAAOQ,OAAO,CAACC,OAAR,CAAgB;AACrBC,MAAAA,cAAc,EAAE,IADK;AAErBC,MAAAA,UAAU,EAAE,KAFS;AAGrBL,MAAAA,OAAO,EAAEP;AAHY,KAAhB,CAAP;AAKD;;AACD,SAAO,6BAAea,IAAf,CAAoB,QAAuB;AAAA,QAArBN,OAAqB,QAArBA,OAAqB;AAAA,QAAZO,MAAY,QAAZA,MAAY;AAChDd,IAAAA,aAAa,CAACC,KAAd,GAAsBM,OAAO,CAACN,KAA9B;AACAD,IAAAA,aAAa,CAACE,SAAd,GAA0BK,OAAO,CAACL,SAAlC;AACAF,IAAAA,aAAa,CAACG,gBAAd,GAAiCI,OAAO,CAACJ,gBAAzC;AACAH,IAAAA,aAAa,CAACI,YAAd,GAA6BG,OAAO,CAACH,YAArC;AACAJ,IAAAA,aAAa,CAACK,iBAAd,GAAkCE,OAAO,CAACF,iBAA1C;AAEA,WAAO;AACLM,MAAAA,cAAc,EAAE,CAACG,MADZ;AAELF,MAAAA,UAAU,EAAE,CAACN,eAAe,CAACN,aAAD,CAFvB;AAGLO,MAAAA,OAAO,EAAEP;AAHJ,KAAP;AAKD,GAZM,CAAP;AAaD;;eAEc,+BACb,MAAMe,aAAN,SAA4BC,gBAA5B,CAAsC;AAmBpCC,EAAAA,WAAW,CAACC,MAAD,EAAQ;AACjB,UAAMA,MAAN;;AADiB,mCAlBX;AACNC,MAAAA,aAAa,EAAE,IADT;AAENC,MAAAA,aAAa,EAAE,KAFT;AAGNC,MAAAA,kBAAkB,EAAE,KAHd;AAINC,MAAAA,0BAA0B,EAAE,IAJtB;AAKNC,MAAAA,KAAK,EAAE,IALD;AAMNC,MAAAA,QAAQ,EAAE,KANJ;AAONb,MAAAA,cAAc,EAAE,IAPV;AAQNc,MAAAA,SAAS,EAAE,SARL;AASNb,MAAAA,UAAU,EAAE,IATN;AAUNL,MAAAA,OAAO,EAAE,IAVH;AAWNmB,MAAAA,QAAQ,EAAE,KAXJ;AAYNC,MAAAA,SAAS,EAAE,KAZL;AAaNC,MAAAA,WAAW,EAAE,KAbP;AAcNC,MAAAA,gBAAgB,EAAE,KAdZ;AAeNC,MAAAA,YAAY,EAAE;AAfR,KAkBW;;AAAA,mCAkCX,MAAM;AACZ,WAAKC,WAAL;AACD,KApCkB;;AAAA,yCAsCL,MAAM;AAClB,WAAKC,QAAL,CAAc;AAACR,QAAAA,QAAQ,EAAE;AAAX,OAAd;AACD,KAxCkB;;AAAA,wCA0CN,MAAM;AACjB,WAAKQ,QAAL,CAAc;AAACR,QAAAA,QAAQ,EAAE;AAAX,OAAd;AACD,KA5CkB;;AAAA,qCAuHT,MAAM;AACd,UAAML,aAAa,GAAG,KAAKc,KAAL,CAAWd,aAAjC;;AACA,UAAI,CAACA,aAAL,EAAoB;AAClB;AACD;;AACD,UAAI,KAAKe,YAAT,EAAuB;AACrB;AACD;;AACD,WAAKA,YAAL,GAAoBC,WAAW,CAAC,MAAM;AACpC,8BAAShB,aAAa,CAACiB,OAAvB,EACGvB,IADH,CACSwB,QAAD,IAAc;AAClB,cAAMnB,KAAK,GAAGmB,QAAQ,CAACC,IAAvB,CADkB,CAGlB;;AACAC,gCACGC,KADH,CACSrB,aAAa,CAACsB,GADvB,EAEGC,GAFH,CAEO;AACHC,YAAAA,MAAM,EAAEzB,KAAK,CAACyB,MADX;AAEHL,YAAAA,IAAI,EAAEpB;AAFH,WAFP,EAMG0B,MANH,CAMU;AAACC,YAAAA,eAAe,EAAE;AAAlB,WANV;AAOD,SAZH,EAaGC,KAbH,CAaUvB,KAAD,IAAW;AAChB,eAAKS,QAAL,CAAc;AAACT,YAAAA;AAAD,WAAd;AACD,SAfH;AAgBD,OAjB8B,EAiB5B,IAjB4B,CAA/B;AAkBD,KAjJkB;;AAAA,sDAmJSwB,KAAD,IAAW;AACpC,WAAKf,QAAL,CAAegB,SAAD,KAAgB;AAACrB,QAAAA,SAAS,EAAE,CAACqB,SAAS,CAACC;AAAvB,OAAhB,CAAd;AACD,KArJkB;;AAAA,6CAuJD,SAA2E;AAAA,UAAzEhD,KAAyE,SAAzEA,KAAyE;AAAA,UAAlEC,SAAkE,SAAlEA,SAAkE;AAAA,UAAvDC,gBAAuD,SAAvDA,gBAAuD;AAAA,UAArCC,YAAqC,SAArCA,YAAqC;AAAA,UAAvBC,iBAAuB,SAAvBA,iBAAuB;AAC3FL,MAAAA,aAAa,CAACC,KAAd,GAAsBA,KAAtB;AACAD,MAAAA,aAAa,CAACE,SAAd,GAA0BA,SAA1B;AACAF,MAAAA,aAAa,CAACG,gBAAd,GAAiCA,gBAAjC;AACAH,MAAAA,aAAa,CAACI,YAAd,GAA6BA,YAA7B;AACAJ,MAAAA,aAAa,CAACK,iBAAd,GAAkCA,iBAAlC;AAEA,WAAK2B,QAAL,CAAc;AACZL,QAAAA,SAAS,EAAE,KADC;AAEZpB,QAAAA,OAAO,EAAEP,aAFG;AAGZY,QAAAA,UAAU,EAAE,CAACN,eAAe,CAACN,aAAD;AAHhB,OAAd;AAKD,KAnKkB;;AAAA,mDAqKK,MAAM;AAC5B,WAAKgC,QAAL,CAAc;AAACL,QAAAA,SAAS,EAAE;AAAZ,OAAd;AACD,KAvKkB;;AAAA,oDAyKOuB,MAAD,IAAY;AACnC,UAAOC,QAAP,GAAmB,KAAKjC,KAAxB,CAAOiC,QAAP;AACA,UAAOV,GAAP,GAAcS,MAAd,CAAOT,GAAP;AACAU,MAAAA,QAAQ,CACNC,oBAAWC,IAAX,CAAgB,CAAC,8BAAa;AAACC,QAAAA,KAAK,EAAE;AAACC,UAAAA,IAAI,EAAEd;AAAP;AAAR,OAAb,EAAmC,EAAnC,CAAD,EAAyC,qBAAI;AAACc,QAAAA,IAAI,EAAEd;AAAP,OAAJ,EAAiB,CAAC,OAAD,CAAjB,CAAzC,CAAhB,CADM,CAAR;AAGA,WAAKT,QAAL,CAAc;AAACb,QAAAA,aAAa,EAAE+B,MAAM,CAACM;AAAvB,OAAd,EAAgD,MAAM;AACpD,aAAKC,kBAAL;AACD,OAFD;AAGD,KAlLkB;;AAAA,4DAoLeV,KAAD,IAAW;AAC1CA,MAAAA,KAAK,CAACW,cAAN;AACAX,MAAAA,KAAK,CAACY,eAAN;AACA,WAAK3B,QAAL,CAAc;AAACZ,QAAAA,aAAa,EAAE;AAAhB,OAAd;AACD,KAxLkB;;AAAA,+CA0LC,MAAM;AACxB,UAAOD,aAAP,GAAwB,KAAKc,KAA7B,CAAOd,aAAP;AACA,WAAKa,QAAL,CAAc;AAACP,QAAAA,SAAS,EAAE;AAAZ,OAAd;;AACA,UAAMmC,UAAU,GAAG,MAAM;AACvB,eAAO,IAAInD,OAAJ,CAAY,CAACC,OAAD,EAAUmD,MAAV,KAAqB;AACtC,eAAK7B,QAAL,CACE;AACEb,YAAAA,aAAa,EAAE,IADjB;AAEEC,YAAAA,aAAa,EAAE,KAFjB;AAGEK,YAAAA,SAAS,EAAE;AAHb,WADF,EAME,MAAM;AACJ,gBAAI,KAAKQ,KAAL,CAAWZ,kBAAX,IAAiC,KAAKY,KAAL,CAAWX,0BAAhD,EAA4E;AAC1E,qBAAOiB,sBACJC,KADI,CACE,KAAKtB,KAAL,CAAWsC,QAAX,CAAoBf,GADtB,EAEJqB,KAFI,CAEE,CAAC,OAAD,CAFF,EAGJlB,MAHI,CAGG;AAACC,gBAAAA,eAAe,EAAE;AAAlB,eAHH,EAIJhC,IAJI,CAIC,MAAM;AACV,oBAAI,CAACM,aAAL,EAAoB;AAClB,yBAAOT,OAAO,EAAd;AACD;;AACD,uBAAO6B,sBACJwB,MADI,CACG5C,aAAa,CAACsB,GADjB,EAEJ5B,IAFI,CAEC,MAAM;AACVH,kBAAAA,OAAO;AACR,iBAJI,EAKJoC,KALI,CAKGvB,KAAD,IAAW;AAChBsC,kBAAAA,MAAM,CAACtC,KAAD,CAAN;AACD,iBAPI,CAAP;AAQD,eAhBI,CAAP;AAiBD;;AACD,mBAAO,KAAKL,KAAL,CAAWiC,QAAX,CAAoBC,oBAAWC,IAAX,CAAgB,wBAAhB,CAApB,CAAP;AACD,WA3BH;AA6BD,SA9BM,CAAP;AA+BD,OAhCD;;AAiCA,aAAOO,UAAU,GACd/C,IADI,CACC,MAAM;AACV,YAAI,KAAKoB,KAAL,CAAWZ,kBAAf,EAAmC;AACjC,iBAAO,yBAAYF,aAAa,CAACiB,OAA1B,EAAmCU,KAAnC,CAA0CvB,KAAD,IAAW;AACzD,iBAAKS,QAAL,CAAc;AAACT,cAAAA;AAAD,aAAd;AACD,WAFM,CAAP;AAGD;;AACD,eAAO,IAAP;AACD,OARI,EASJuB,KATI,CASGvB,KAAD,IAAW;AAChB,aAAKS,QAAL,CAAc;AAACT,UAAAA;AAAD,SAAd;AACD,OAXI,CAAP;AAYD,KA1OkB;;AAAA,gDA4OGwB,KAAD,IAAW;AAC9B,WAAKf,QAAL,CAAc;AACZZ,QAAAA,aAAa,EAAE,KADH;AAEZC,QAAAA,kBAAkB,EAAE,IAFR;AAGZC,QAAAA,0BAA0B,EAAE;AAHhB,OAAd;AAKD,KAlPkB;;AAAA,8DAoPiByB,KAAD,IAAW;AAC5C,WAAKf,QAAL,CAAegB,SAAD,KAAgB;AAC5B3B,QAAAA,kBAAkB,EAAE,CAAC2B,SAAS,CAAC3B;AADH,OAAhB,CAAd;AAGD,KAxPkB;;AAAA,sEA0PyB0B,KAAD,IAAW;AACpD,WAAKf,QAAL,CAAegB,SAAD,KAAgB;AAC5B1B,QAAAA,0BAA0B,EAAE,CAAC0B,SAAS,CAAC1B;AADX,OAAhB,CAAd;AAGD,KA9PkB;;AAAA,6CAgQAyB,KAAD,IAAW;AAC3B,UAAI,CAAC,KAAKiB,WAAL,CAAiBC,OAAtB,EAA+B;AAC7B;AACD;;AACD,wBAAkC,KAAKhC,KAAvC;AAAA,UAAOd,aAAP,eAAOA,aAAP;AAAA,UAAsBO,QAAtB,eAAsBA,QAAtB;AACA,UAAMwC,WAAW,GAAG,KAAKF,WAAL,CAAiBC,OAAjB,CAAyBE,eAAzB,GAA2CD,WAA/D;AACA,UAAME,OAAO,GAAG;AACdC,QAAAA,IAAI,EAAElD,aAAa,CAACmD,SADN;AAEdC,QAAAA,KAAK,EAAE,GAFO;AAGdC,QAAAA,MAAM,EAAE,GAHM;AAIdC,QAAAA,OAAO,EAAE,MAJK;AAKd/C,QAAAA,QALc;AAMdtB,QAAAA,YAAY,EAAEJ,aAAa,CAACI,YANd;AAOdC,QAAAA,iBAAiB,EAAEL,aAAa,CAACK;AAPnB,OAAhB;AAUA,UAAMqE,KAAK,GAAG,2BAAavD,aAAa,CAACwD,UAA3B,EAAuCP,OAAvC,CAAd;AACA,UAAMQ,QAAQ,GAAG,2BAAazD,aAAa,CAACwD,UAA3B,kCAA2CP,OAA3C;AAAoDC,QAAAA,IAAI,EAAEH;AAA1D,SAAjB;AAEA,WAAKlC,QAAL,CAAc;AAAC0C,QAAAA,KAAD;AAAQE,QAAAA;AAAR,OAAd;AACD,KApRkB;;AAAA,kDAsRK7B,KAAD,IAAW;AAChC,UAAI,CAAC,KAAKiB,WAAL,CAAiBC,OAAtB,EAA+B;AAC7B;AACD;;AAED,WAAKjC,QAAL,CAAc;AAACF,QAAAA,YAAY,EAAE;AAAf,OAAd;AACA,yBAAkC,KAAKG,KAAvC;AAAA,UAAOd,aAAP,gBAAOA,aAAP;AAAA,UAAsBO,QAAtB,gBAAsBA,QAAtB;AACA,UAAMwC,WAAW,GAAG,KAAKF,WAAL,CAAiBC,OAAjB,CAAyBE,eAAzB,GAA2CD,WAA/D;;AACA3B,4BACGC,KADH,CACSrB,aAAa,CAACsB,GADvB,EAEGC,GAFH,CAEO;AACH4B,QAAAA,SAAS,EAAEJ;AADR,OAFP,EAKGtB,MALH,CAKU;AAACC,QAAAA,eAAe,EAAE;AAAlB,OALV,EAMGhC,IANH,CAMSwB,QAAD,IAAc;AAClB,YAAM+B,OAAO,GAAG;AACdC,UAAAA,IAAI,EAAEH,WADQ;AAEdK,UAAAA,KAAK,EAAE,GAFO;AAGdC,UAAAA,MAAM,EAAE,GAHM;AAIdC,UAAAA,OAAO,EAAE,MAJK;AAKd/C,UAAAA,QALc;AAMdtB,UAAAA,YAAY,EAAEJ,aAAa,CAACI,YANd;AAOdC,UAAAA,iBAAiB,EAAEL,aAAa,CAACK;AAPnB,SAAhB;AAUA,YAAMqE,KAAK,GAAG,2BAAavD,aAAa,CAACwD,UAA3B,EAAuCP,OAAvC,CAAd;AAEA,aAAKpC,QAAL,CAAc;AAAC0C,UAAAA,KAAD;AAAQ5C,UAAAA,YAAY,EAAE;AAAtB,SAAd;AACD,OApBH,EAqBGgB,KArBH,CAqBUvB,KAAD,IAAW;AAChB,aAAKS,QAAL,CAAc;AAACT,UAAAA,KAAD;AAAQO,UAAAA,YAAY,EAAE;AAAtB,SAAd;AACD,OAvBH;AAwBD,KAtTkB;;AAAA,8CAwTCiB,KAAD,IAAW;AAC5B,UAAIA,KAAJ,EAAW;AACTA,QAAAA,KAAK,CAACW,cAAN;AACD;;AAED,WAAK1B,QAAL,CAAc;AACZT,QAAAA,KAAK,EAAE;AADK,OAAd;AAGD,KAhUkB;;AAAA,qDAkUQwB,KAAD,IAAW;AACnC,WAAKf,QAAL,CAAc;AAAC0C,QAAAA,KAAK,EAAE;AAAR,OAAd;AACD,KApUkB;;AAAA,gDAsUG3B,KAAD,IAAW;AAC9B,WAAKf,QAAL,CAAc;AAACJ,QAAAA,WAAW,EAAE;AAAd,OAAd;AACD,KAxUkB;;AAAA,gDA0UGmB,KAAD,IAAW;AAC9B,WAAKf,QAAL,CAAc;AAACJ,QAAAA,WAAW,EAAE;AAAd,OAAd;AACD,KA5UkB;;AAAA,+CA8UE0B,KAAD,IAAW;AAC7B,UAAOH,QAAP,GAAmB,KAAKjC,KAAxB,CAAOiC,QAAP;AAEAA,MAAAA,QAAQ,CACNC,oBAAWC,IAAX,CAAgB,CACd,8BAAa;AAACC,QAAAA,KAAK,EAAE;AAACC,UAAAA,IAAI,EAAED,KAAK,CAACb;AAAb;AAAR,OAAb,EAAyC,EAAzC,CADc,EAEd,qBAAI;AAACc,QAAAA,IAAI,EAAED,KAAK,CAACb;AAAb,OAAJ,EAAuB,CAAC,OAAD,CAAvB,CAFc,CAAhB,CADM,CAAR;AAOA,WAAKT,QAAL,CAAc;AAACJ,QAAAA,WAAW,EAAE,KAAd;AAAqBT,QAAAA,aAAa,EAAEmC;AAApC,OAAd,EAA0D,MAAM;AAC9D,aAAKG,kBAAL;AACD,OAFD;AAGD,KA3VkB;;AAAA,oDA6VM,MAAM;AAC7B,WAAKzB,QAAL,CAAc;AAACH,QAAAA,gBAAgB,EAAE;AAAnB,OAAd;AACD,KA/VkB;;AAEjBrB,IAAAA,UAAU,GACPK,IADH,CACQ,SAA2C;AAAA;;AAAA,UAAzCN,OAAyC,SAAzCA,OAAyC;AAAA,UAAhCI,cAAgC,SAAhCA,cAAgC;AAAA,UAAhBC,UAAgB,SAAhBA,UAAgB;AAC/C,WAAKoB,QAAL,CAAc;AACZzB,QAAAA,OADY;AAEZI,QAAAA,cAFY;AAGZC,QAAAA,UAHY;AAIZa,QAAAA,SAAS,kBAAEP,MAAK,CAAC2D,KAAR,iDAAE,aAAavB,KAJZ,CAImB;;AAJnB,OAAd;AAMD,KARH,EASGR,KATH,CASUvB,KAAD,IAAW,KAAKS,QAAL,CAAc;AAACT,MAAAA;AAAD,KAAd,CATpB;AAWA,SAAKuD,WAAL,gBAAmBC,eAAMC,SAAN,EAAnB;AACA,SAAK9C,YAAL,GAAoB,IAApB;AACA,SAAK+C,KAAL,gBAAaF,eAAMC,SAAN,EAAb;AACA,SAAKE,iBAAL,gBAAyBH,eAAMC,SAAN,EAAzB;AACA,SAAKhB,WAAL,gBAAmBe,eAAMC,SAAN,EAAnB;AACD;;AAEDG,EAAAA,iBAAiB,GAAG;AAClB,SAAK1B,kBAAL;AACD;;AAED2B,EAAAA,oBAAoB,GAAG;AACrB,QAAI,KAAKC,YAAT,EAAuB;AACrB,WAAKA,YAAL,CAAkBC,WAAlB;AACD;;AACD,QAAI,KAAKpD,YAAT,EAAuB;AACrBqD,MAAAA,aAAa,CAAC,KAAKrD,YAAN,CAAb;AACA,WAAKA,YAAL,GAAoB,IAApB;AACD;AACF;;AAcDsD,EAAAA,QAAQ,GAAG;AACT,QAAOX,KAAP,GAAgB,KAAK3D,KAArB,CAAO2D,KAAP;AACA,WAAOA,KAAK,GAAGA,KAAK,CAACvB,KAAT,GAAiB,IAA7B;AACD;;AAEDG,EAAAA,kBAAkB,GAAG;AACnB,QAAI,KAAK4B,YAAT,EAAuB;AACrB,WAAKA,YAAL,CAAkBC,WAAlB;AACD;;AACD,SAAKtD,QAAL,CAAc;AAACH,MAAAA,gBAAgB,EAAE;AAAnB,KAAd;AACA,QAAMyB,KAAK,GAAG,KAAKkC,QAAL,EAAd;;AACA,QAAI,CAAClC,KAAL,EAAY;AACV;AACD;;AACD,SAAK+B,YAAL,GAAoB,2BAAa/B,KAAb,EAAoB,CACtC,WADsC,EAEtC,MAFsC,EAGtC,SAHsC,EAItC,YAJsC,EAKtC,QALsC,CAApB,EAOjBmC,IAPiB,CAQhB,oBAAKtE,aAAD,IAAmB;AAAA;;AACrB,WAAKa,QAAL,CAAc;AAACb,QAAAA;AAAD,OAAd;;AACA,UAAIA,aAAa,IAAIA,aAAa,CAACwB,MAAd,KAAyB,SAA9C,EAAyD;AACvD4C,QAAAA,aAAa,CAAC,KAAKrD,YAAN,CAAb;AACA,aAAKA,YAAL,GAAoB,IAApB,CAFuD,CAGvD;AACA;;AACA,eAAO,KAAKwD,iBAAL,GAAyB7E,IAAzB,CAA8B,MAAM;AACzC,eAAKmB,QAAL,CAAc;AACZP,YAAAA,SAAS,EAAE,KADC;AAEZF,YAAAA,KAAK,EAAE,IAAIoE,KAAJ,CAAUxE,aAAa,CAACmB,IAAd,CAAmBsD,MAAnB,CAA0BC,QAA1B,CAAmCC,IAAnC,CAAwC,GAAxC,CAAV;AAFK,WAAd;AAID,SALM,CAAP;AAMD,OAboB,CAcrB;;;AACA,UACE,CAAA3E,aAAa,SAAb,IAAAA,aAAa,WAAb,YAAAA,aAAa,CAAEwB,MAAf,MAA0B,WAA1B,IACA,CAAAxB,aAAa,SAAb,IAAAA,aAAa,WAAb,mCAAAA,aAAa,CAAEmB,IAAf,qGAAqByD,iBAArB,gFAAwCpD,MAAxC,MAAmD,WAFrD,EAGE;AACA,aAAKqD,OAAL;AACD,OApBoB,CAqBrB;AACA;AACA;AACA;;;AACA,UAAI7E,aAAa,IAAIA,aAAa,CAACwB,MAAd,KAAyB,OAA9C,EAAuD;AACrD,gBAAQsD,gBAAOC,WAAf;AACE,eAAK,UAAL;AACE,gBAAI,CAAA/E,aAAa,SAAb,IAAAA,aAAa,WAAb,oCAAAA,aAAa,CAAEmB,IAAf,uGAAqByD,iBAArB,gFAAwCpD,MAAxC,MAAmD,OAAvD,EAAgE;AAC9D4C,cAAAA,aAAa,CAAC,KAAKrD,YAAN,CAAb;AACA,mBAAKA,YAAL,GAAoB,IAApB;AACD;;AACD;;AACF,eAAK,MAAL;AACA;AACEqD,YAAAA,aAAa,CAAC,KAAKrD,YAAN,CAAb;AACA,iBAAKA,YAAL,GAAoB,IAApB;AACA;AAXJ;AAaD,OAvCoB,CAyCrB;;;AACA,UAAMR,QAAQ,GAAG,CAAAP,aAAa,SAAb,IAAAA,aAAa,WAAb,oCAAAA,aAAa,CAAEmB,IAAf,uGAAqB6D,YAArB,CAAkC,CAAlC,iFAAsCC,MAAtC,MAAiD,QAAlE;AACA,WAAKpE,QAAL,CAAc;AAACb,QAAAA,aAAD;AAAgBO,QAAAA,QAAhB;AAA0BD,QAAAA,SAAS,EAAE;AAArC,OAAd;AAEA,aAAO,cAAGN,aAAH,CAAP;AACD,KA9CD,CARgB,EAwDjBkF,SAxDiB,EAApB;AAyDD;;AA4ODC,EAAAA,WAAW,GAAG;AACZ,QAAO/F,OAAP,GAAkB,KAAK0B,KAAvB,CAAO1B,OAAP;AAEA,wBACE,6BAAC,UAAD;AACE,MAAA,MAAM,EAAC,qBADT;AAEE,MAAA,KAAK,EAAE,CAFT;AAGE,MAAA,OAAO,EAAE,KAAKgG,qBAHhB;AAIE,MAAA,OAAO,EAAE;AAJX,oBAME,6BAAC,cAAD;AACE,MAAA,OAAO,EAAEhG,OAAO,IAAI,IADtB;AAEE,MAAA,MAAM,EAAE,KAAKiG,eAFf;AAGE,MAAA,QAAQ,EAAE,KAAKD;AAHjB,MANF,CADF;AAcD;;AAEDE,EAAAA,iBAAiB,GAAG;AAClB,uBAA2C,KAAKxE,KAAhD;AAAA,QAAOR,SAAP,gBAAOA,SAAP;AAAA,QAAkBE,SAAlB,gBAAkBA,SAAlB;AAAA,QAA6Bf,UAA7B,gBAA6BA,UAA7B;AACA,QAAM0F,WAAW,GAAG,CAAC7E,SAAD,IAAcE,SAAlC;AACA,wBACE;AAAK,MAAA,SAAS,EAAE+E,eAAOC;AAAvB,oBACE,6BAAC,UAAD;AACE,MAAA,IAAI,EAAE/F,UAAU,GAAG,UAAH,GAAgB,UADlC;AAEE,MAAA,IAAI,EAAC,OAFP;AAGE,MAAA,OAAO,EAAE,KAAKgG,wBAHhB;AAIE,MAAA,IAAI,EAAEC,mBAJR;AAKE,MAAA,OAAO,EAAE,CALX;AAME,MAAA,MAAM,EAAE,CANV;AAOE,oBAAW;AAPb,MADF,EAUGP,WAAW,IAAI,KAAKA,WAAL,EAVlB,CADF;AAcD;;AAEDQ,EAAAA,iBAAiB,GAAG;AAClB,uBAAoC,KAAK7E,KAAzC;AAAA,QAAOR,SAAP,gBAAOA,SAAP;AAAA,QAAkBd,cAAlB,gBAAkBA,cAAlB;;AAEA,QAAIc,SAAJ,EAAe;AACb,aAAO,IAAP;AACD;;AAED,wBACE,6BAAC,SAAD;AAAO,MAAA,OAAO,EAAE,CAAhB;AAAmB,MAAA,KAAK,EAAE,CAA1B;AAA6B,MAAA,KAAK,EAAE;AAACsF,QAAAA,eAAe,EAAE,WAAlB;AAA+BC,QAAAA,YAAY,EAAE;AAA7C;AAApC,oBACE,6BAAC,gBAAD,OADF,eAEE,6BAAC,SAAD;AAAO,MAAA,KAAK,EAAE;AAAd,OACGrG,cAAc,iBACb,6BAAC,QAAD,uGAFJ,eAOE,6BAAC,QAAD,0EAPF,eAQE,6BAAC,QAAD,oEARF,CAFF,CADF;AAeD,GAhbmC,CAkbpC;;;AACAsG,EAAAA,WAAW,GAAG;AACZ,uBAAkC,KAAKhF,KAAvC;AAAA,QAAOd,aAAP,gBAAOA,aAAP;AAAA,QAAsBO,QAAtB,gBAAsBA,QAAtB;AACA,QAAMuF,WAAW,GAAG,CAAC,CAAC9F,aAAtB;;AACA,QAAI,CAAC8F,WAAL,EAAkB;AAChB,aAAO,IAAP;AACD;;AACD,QAAMC,aAAa,GAAGxF,QAAQ,gBAC5B,6BAAC,QAAD;AAAM,MAAA,OAAO,EAAE,CAAf;AAAkB,MAAA,MAAM,EAAE,CAA1B;AAA6B,MAAA,MAAM,EAAE,CAArC;AAAwC,MAAA,IAAI,EAAC;AAA7C,oBACE,6BAAC,QAAD;AAAM,MAAA,IAAI,EAAE;AAAZ,+CADF,CAD4B,GAI1B,IAJJ;AAKA,wBACE,6BAAC,SAAD;AAAO,MAAA,KAAK,EAAE,CAAd;AAAiB,MAAA,YAAY,EAAE;AAA/B,OACGwF,aADH,eAEE,6BAAC,cAAD;AACE,MAAA,aAAa,EAAE/F,aADjB;AAEE,MAAA,GAAG,EAAE,KAAK6C,WAFZ;AAGE,MAAA,OAAO,EAAE,KAAKmD,sBAHhB;AAIE,MAAA,QAAQ,EAAE,KAAKzB;AAJjB,MAFF,CADF;AAWD;;AAED0B,EAAAA,kBAAkB,GAAG;AACnB,uBAAuC,KAAKnF,KAA5C;AAAA,QAAOd,aAAP,gBAAOA,aAAP;AAAA,QAAsBC,aAAtB,gBAAsBA,aAAtB;AACA,QAAOiG,QAAP,GAAmB,KAAKnG,KAAxB,CAAOmG,QAAP;;AACA,QAAIlG,aAAa,IAAIA,aAAa,CAACwB,MAAd,KAAyB,OAA1C,IAAqD,CAAC0E,QAA1D,EAAoE;AAClE,aAAO,cACL,6BAAC,UAAD;AACE,QAAA,GAAG,EAAC,QADN;AAEE,QAAA,IAAI,EAAC,OAFP;AAGE,QAAA,IAAI,EAAC,SAHP;AAIE,QAAA,OAAO,EAAE,KAAKC,kBAJhB;AAKE,QAAA,IAAI,EAAC;AALP,QADK,eAQL,6BAAC,UAAD;AACE,QAAA,GAAG,EAAC,WADN;AAEE,QAAA,IAAI,EAAC,OAFP;AAGE,QAAA,IAAI,EAAC,SAHP;AAIE,QAAA,QAAQ,EAAE,KAAKrF,KAAL,CAAWJ,gBAAX,KAAgC,KAJ5C;AAKE,QAAA,OAAO,EAAE,KAAK0F,eALhB;AAME,QAAA,IAAI,EAAC;AANP,QARK,eAgBL,6BAAC,UAAD;AACE,QAAA,GAAG,EAAC,QADN;AAEE,QAAA,GAAG,EAAE,KAAKrC,iBAFZ;AAGE,QAAA,OAAO,EAAE9D,aAAa,GAAGrB,IAAH,GAAU,KAAKyH,8BAHvC;AAIE,QAAA,IAAI,EAAC,OAJP;AAKE,QAAA,IAAI,EAAC,UALP;AAME,QAAA,IAAI,EAAC;AANP,QAhBK,CAAP;AAyBD;;AACD,WAAO,IAAP;AACD;;AAEDC,EAAAA,aAAa,GAAG;AACd,wBACE,6BAAC,mBAAD;AAAkB,MAAA,KAAK,EAAC,cAAxB;AAAuC,MAAA,OAAO,EAAE,KAAKC,kBAArD;AAAyE,MAAA,MAAM;AAA/E,oBACE,6BAAC,oBAAD;AAAa,MAAA,QAAQ,EAAE,KAAKC;AAA5B,MADF,CADF;AAKD;;AAEDC,EAAAA,WAAW,GAAG;AACZ,QAAOrG,KAAP,GAAgB,KAAKU,KAArB,CAAOV,KAAP;;AACA,QAAI,CAACA,KAAL,EAAY;AACV,aAAO,IAAP;AACD;;AACD,wBACE,6BAAC,UAAD;AAAQ,MAAA,MAAM,EAAC,OAAf;AAAuB,MAAA,OAAO,EAAE,KAAKsG;AAArC,oBACE,6BAAC,gBAAD;AAAe,MAAA,IAAI,EAAC;AAApB,OAA6BtG,KAAK,CAACuG,OAAnC,CADF,CADF;AAKD;;AAEDC,EAAAA,MAAM,GAAG;AAAA;;AACP,sBAA+B,KAAK7G,KAApC;AAAA,QAAO8G,IAAP,eAAOA,IAAP;AAAA,QAAaC,KAAb,eAAaA,KAAb;AAAA,QAAoBC,OAApB,eAAoBA,OAApB;AACA,uBAUI,KAAKjG,KAVT;AAAA,QACER,SADF,gBACEA,SADF;AAAA,QAEElB,OAFF,gBAEEA,OAFF;AAAA,QAGEiB,QAHF,gBAGEA,QAHF;AAAA,QAIEZ,UAJF,gBAIEA,UAJF;AAAA,QAKEW,KALF,gBAKEA,KALF;AAAA,QAMEK,WANF,gBAMEA,WANF;AAAA,QAOER,aAPF,gBAOEA,aAPF;AAAA,QAQEsD,KARF,gBAQEA,KARF;AAAA,QASEvD,aATF,gBASEA,aATF;AAYA,QAAMgH,cAAc,GAAG,CAAAhH,aAAa,SAAb,IAAAA,aAAa,WAAb,oCAAAA,aAAa,CAAEmB,IAAf,uGAAqB8F,YAArB,0GAAmCC,KAAnC,CAAyC,GAAzC,mFAA+CvC,IAA/C,CAAoD,GAApD,MAA4D,MAAnF;AAEA,wBACE,6BAAC,iBAAD;AAAe,MAAA,KAAK,EAAEwC;AAAtB,oBACE,6BAAC,OAAD;AAAK,MAAA,KAAK,EAAE;AAACC,QAAAA,QAAQ,EAAE;AAAX;AAAZ,oBACE,6BAAC,QAAD;AAAM,MAAA,KAAK,EAAC,QAAZ;AAAqB,MAAA,OAAO,EAAC;AAA7B,oBACE,6BAAC,iBAAD;AACE,MAAA,KAAK,EAAEP,IAAI,CAACQ,KADd;AAEE,MAAA,OAAO,EAAEN,OAFX;AAGE,MAAA,WAAW,EAAEF,IAAI,CAACS,WAHpB;AAIE,MAAA,KAAK,EAAER,KAJT;AAKE,MAAA,SAAS,EAAEvB,eAAOgC;AALpB,MADF,EAQG,KAAKjC,iBAAL,EARH,CADF,EAYGhF,SAAS,KAAK,SAAd,iBACC,6BAAC,OAAD;AAAK,MAAA,YAAY,EAAE;AAAnB,oBACE,6BAAC,UAAD;AAAQ,MAAA,KAAK,EAAC,QAAd;AAAuB,MAAA,KAAK,EAAE;AAA9B,oBACE,6BAAC,gBAAD;AAAS,MAAA,MAAM;AAAf,MADF,eAEE,6BAAC,QAAD;AAAM,MAAA,IAAI,EAAE;AAAZ,8BAFF,CADF,CAbJ,EAqBGb,UAAU,IAAI,KAAKkG,iBAAL,EArBjB,EAuBG,CAAClG,UAAD,iBACC,6BAAC,iBAAD;AACE,MAAA,OAAO,EAAE,KAAKwG,kBAAL,EADX;AAEE,MAAA,QAAQ,EAAE5F,QAFZ,CAGE;AAHF;AAIE,MAAA,MAAM,EAAE,KAAKmH,IAJf,CAKE;AALF;AAME,MAAA,OAAO,EAAE,KAAKC,KANhB;AAOE,MAAA,oBAAoB,EAAE,KAAKhC,wBAP7B;AAQE,MAAA,gBAAgB,EAAE,KAAKiC,sBARzB;AASE,MAAA,OAAO,EAAEtI,OATX;AAUE,MAAA,QAAQ,EAAE,KAAK+G;AAVjB,OAYG,KAAKL,WAAL,EAZH,CAxBJ,EAwCGvC,KAAK,iBACJ,6BAAC,UAAD;AAAQ,MAAA,MAAM,EAAC,WAAf;AAA2B,MAAA,OAAO,EAAE,IAApC;AAA0C,MAAA,OAAO,EAAE,KAAKoE;AAAxD,oBACE,6BAAC,SAAD;AAAO,MAAA,KAAK,EAAE,CAAd;AAAiB,MAAA,OAAO,EAAE;AAA1B,oBACE,6BAAC,SAAD;AAAO,MAAA,KAAK,EAAE;AAAd,oBACE,6BAAC,SAAD;AAAO,MAAA,KAAK,EAAE;AAAd,oBACE,6BAAC,QAAD;AAAM,MAAA,IAAI,EAAE,CAAZ;AAAe,MAAA,MAAM,EAAC;AAAtB,kBADF,eAIE;AACE,MAAA,KAAK,EAAE;AACLC,QAAAA,QAAQ,EAAE,MADL;AAEL/B,QAAAA,YAAY,EAAE,WAFT;AAGLgC,QAAAA,OAAO,EAAE,OAHJ;AAILC,QAAAA,WAAW,EAAEd;AAJR,OADT;AAOE,MAAA,GAAG,EAAE,KAAKlG,KAAL,CAAWyC,KAPlB;AAQE,MAAA,KAAK,EAAE;AART,MAJF,CADF,eAgBE,6BAAC,SAAD;AAAO,MAAA,KAAK,EAAE;AAAd,oBACE,6BAAC,QAAD;AAAM,MAAA,IAAI,EAAE,CAAZ;AAAe,MAAA,MAAM,EAAC;AAAtB,cADF,eAIE;AACE,MAAA,KAAK,EAAE;AACLqE,QAAAA,QAAQ,EAAE,MADL;AAEL/B,QAAAA,YAAY,EAAE,WAFT;AAGLgC,QAAAA,OAAO,EAAE,OAHJ;AAILC,QAAAA,WAAW,EAAEd;AAJR,OADT;AAOE,MAAA,GAAG,EAAE,KAAKlG,KAAL,CAAW2C,QAPlB;AAQE,MAAA,KAAK,EAAE;AART,MAJF,CAhBF,CADF,eAiCE,6BAAC,UAAD;AACE,MAAA,GAAG,EAAC,WADN;AAEE,MAAA,IAAI,EAAC,OAFP;AAGE,MAAA,IAAI,EAAC,SAHP;AAIE,MAAA,QAAQ,EAAE,KAAK3C,KAAL,CAAWJ,gBAAX,KAAgC,KAJ5C;AAKE,MAAA,OAAO,EAAE,KAAKqH,oBALhB;AAME,MAAA,OAAO,EAAE,KAAKjH,KAAL,CAAWH,YANtB;AAOE,MAAA,IAAI,EAAC;AAPP,MAjCF,CADF,CAzCJ,EAwFGF,WAAW,IAAI,KAAK6F,aAAL,EAxFlB,EA0FGrG,aAAa,iBACZ,6BAAC,UAAD;AAAQ,MAAA,MAAM,EAAC,cAAf;AAA8B,MAAA,OAAO,EAAE,IAAvC;AAA6C,MAAA,OAAO,EAAE,KAAK+H;AAA3D,oBACE,6BAAC,OAAD;AAAK,MAAA,OAAO,EAAE;AAAd,oBACE,6BAAC,SAAD;AAAO,MAAA,KAAK,EAAE;AAAd,oBACE,6BAAC,QAAD;AAAM,MAAA,KAAK,EAAC;AAAZ,oBACE,6BAAC,YAAD;AACE,MAAA,OAAO,EAAE,KAAKlH,KAAL,CAAWZ,kBADtB;AAEE,MAAA,QAAQ,EAAE,KAAK+H;AAFjB,MADF,eAKE,6BAAC,QAAD;AAAM,MAAA,KAAK,EAAE;AAACC,QAAAA,MAAM,EAAE;AAAT;AAAb,6BALF,CADF,eAQE,6BAAC,QAAD;AAAM,MAAA,KAAK,EAAC;AAAZ,oBACE,6BAAC,YAAD;AACE,MAAA,QAAQ,EAAE,KAAKpH,KAAL,CAAWZ,kBADvB;AAEE,MAAA,OAAO,EACL,KAAKY,KAAL,CAAWZ,kBAAX,IAAiC,KAAKY,KAAL,CAAWX,0BAHhD;AAKE,MAAA,QAAQ,EAAE,KAAKgI;AALjB,MADF,eAQE,6BAAC,QAAD;AAAM,MAAA,KAAK,EAAE;AAACD,QAAAA,MAAM,EAAE;AAAT;AAAb,mCARF,CARF,eAkBE,6BAAC,QAAD;AAAM,MAAA,OAAO,EAAE,CAAf;AAAkB,MAAA,GAAG,EAAE;AAAvB,oBACE,6BAAC,UAAD;AACE,MAAA,IAAI,EAAC,OADP;AAEE,MAAA,IAAI,EAAC,SAFP;AAGE,MAAA,IAAI,EAAC,QAHP;AAIE,MAAA,OAAO,EAAE,KAAKF,kBAJhB;AAKE,MAAA,OAAO,EAAE,CAAC,CAAC1H;AALb,MADF,eAQE,6BAAC,UAAD;AACE,MAAA,IAAI,EAAC,SADP;AAEE,MAAA,IAAI,EAAC,UAFP;AAGE,MAAA,IAAI,EAAC,QAHP;AAIE,MAAA,OAAO,EAAE,KAAKiE,iBAJhB;AAKE,MAAA,OAAO,EAAE,CAAC,CAACjE;AALb,MARF,CAlBF,CADF,CADF,CA3FJ,EAoIGF,KAAK,IAAI,KAAKqG,WAAL,EApIZ,CADF,CADF;AA0ID;;AA1pBmC,CADzB,C","sourcesContent":["import {\r\n  Box,\r\n  Button,\r\n  Card,\r\n  Checkbox,\r\n  Dialog,\r\n  Flex,\r\n  Grid,\r\n  Inline,\r\n  Stack,\r\n  studioTheme,\r\n  Text,\r\n  ThemeProvider,\r\n} from '@sanity/ui'\r\nimport SetupIcon from 'part:@sanity/base/plugin-icon'\r\nimport {observePaths} from 'part:@sanity/base/preview'\r\nimport DialogContent from 'part:@sanity/components/dialogs/content'\r\nimport FullscreenDialog from 'part:@sanity/components/dialogs/fullscreen'\r\nimport FormField from 'part:@sanity/components/formfields/default'\r\nimport Spinner from 'part:@sanity/components/loading/spinner'\r\nimport {withDocument} from 'part:@sanity/form-builder'\r\nimport PatchEvent, {set, setIfMissing, unset} from 'part:@sanity/form-builder/patch-event'\r\nimport React, {Component} from 'react'\r\nimport {of} from 'rxjs'\r\nimport {tap} from 'rxjs/operators'\r\nimport {deleteAsset, getAsset} from '../actions/assets'\r\nimport {fetchSecrets} from '../actions/secrets'\r\nimport client from '../clients/SanityClient'\r\nimport getPosterSrc from '../util/getPosterSrc'\r\nimport styles from './Input.css'\r\nimport MuxLogo from './MuxLogo'\r\nimport SelectAsset from './SelectAsset'\r\nimport Setup from './Setup'\r\nimport Uploader from './Uploader'\r\nimport Video from './Video'\r\nimport config from '../config'\r\n\r\nconst NOOP = () => {\r\n  /* intentional noop */\r\n}\r\n\r\nconst cachedSecrets = {\r\n  token: null,\r\n  secretKey: null,\r\n  enableSignedUrls: false,\r\n  signingKeyId: null,\r\n  signingKeyPrivate: null,\r\n}\r\n\r\nfunction validateSecrets(secrets) {\r\n  if (!secrets.token || !secrets.secretKey) return false\r\n\r\n  return true\r\n}\r\n\r\nfunction getSecrets() {\r\n  if (cachedSecrets.token) {\r\n    return Promise.resolve({\r\n      isInitialSetup: true,\r\n      needsSetup: false,\r\n      secrets: cachedSecrets,\r\n    })\r\n  }\r\n  return fetchSecrets().then(({secrets, exists}) => {\r\n    cachedSecrets.token = secrets.token\r\n    cachedSecrets.secretKey = secrets.secretKey\r\n    cachedSecrets.enableSignedUrls = secrets.enableSignedUrls\r\n    cachedSecrets.signingKeyId = secrets.signingKeyId\r\n    cachedSecrets.signingKeyPrivate = secrets.signingKeyPrivate\r\n\r\n    return {\r\n      isInitialSetup: !exists,\r\n      needsSetup: !validateSecrets(cachedSecrets),\r\n      secrets: cachedSecrets,\r\n    }\r\n  })\r\n}\r\n\r\nexport default withDocument(\r\n  class MuxVideoInput extends Component {\r\n    state = {\r\n      assetDocument: null,\r\n      confirmRemove: false,\r\n      deleteOnMuxChecked: false,\r\n      deleteAssetDocumentChecked: true,\r\n      error: null,\r\n      hasFocus: false,\r\n      isInitialSetup: true,\r\n      isLoading: 'secrets',\r\n      needsSetup: true,\r\n      secrets: null,\r\n      isSigned: false,\r\n      showSetup: false,\r\n      showBrowser: false,\r\n      videoReadyToPlay: false,\r\n      thumbLoading: false,\r\n    }\r\n\r\n    constructor(props) {\r\n      super(props)\r\n      getSecrets()\r\n        .then(({secrets, isInitialSetup, needsSetup}) => {\r\n          this.setState({\r\n            secrets,\r\n            isInitialSetup,\r\n            needsSetup,\r\n            isLoading: props.value?.asset, // If there is an asset continue loading\r\n          })\r\n        })\r\n        .catch((error) => this.setState({error}))\r\n\r\n      this.setupButton = React.createRef()\r\n      this.pollInterval = null\r\n      this.video = React.createRef()\r\n      this.removeVideoButton = React.createRef()\r\n      this.videoPlayer = React.createRef()\r\n    }\r\n\r\n    componentDidMount() {\r\n      this.setupAssetListener()\r\n    }\r\n\r\n    componentWillUnmount() {\r\n      if (this.subscription) {\r\n        this.subscription.unsubscribe()\r\n      }\r\n      if (this.pollInterval) {\r\n        clearInterval(this.pollInterval)\r\n        this.pollInterval = null\r\n      }\r\n    }\r\n\r\n    focus = () => {\r\n      this.handleFocus()\r\n    }\r\n\r\n    handleFocus = () => {\r\n      this.setState({hasFocus: true})\r\n    }\r\n\r\n    handleBlur = () => {\r\n      this.setState({hasFocus: false})\r\n    }\r\n\r\n    getAsset() {\r\n      const {value} = this.props\r\n      return value ? value.asset : null\r\n    }\r\n\r\n    setupAssetListener() {\r\n      if (this.subscription) {\r\n        this.subscription.unsubscribe()\r\n      }\r\n      this.setState({videoReadyToPlay: false})\r\n      const asset = this.getAsset()\r\n      if (!asset) {\r\n        return\r\n      }\r\n      this.subscription = observePaths(asset, [\r\n        'thumbTime',\r\n        'data',\r\n        'assetId',\r\n        'playbackId',\r\n        'status',\r\n      ])\r\n        .pipe(\r\n          tap((assetDocument) => {\r\n            this.setState({assetDocument})\r\n            if (assetDocument && assetDocument.status === 'errored') {\r\n              clearInterval(this.pollInterval)\r\n              this.pollInterval = null\r\n              // eslint-disable-next-line no-warning-comments\r\n              // todo: use client.observable\r\n              return this.handleRemoveVideo().then(() => {\r\n                this.setState({\r\n                  isLoading: false,\r\n                  error: new Error(assetDocument.data.errors.messages.join(' ')),\r\n                })\r\n              })\r\n            }\r\n            // Poll MUX if it's preparing the main document or its own static renditions\r\n            if (\r\n              assetDocument?.status === 'preparing' ||\r\n              assetDocument?.data?.static_renditions?.status === 'preparing'\r\n            ) {\r\n              this.pollMux()\r\n            }\r\n            // If MP4 support is enabled: MUX will prepare static_renditions only _after_ an asset\r\n            // has been successfully uploaded.\r\n            // A _ready_ asset doesn't mean static mp4s are generated and ready for use!\r\n            // In these cases, wait for `static_renditions.status === 'ready'` before clearing the poll interval.\r\n            if (assetDocument && assetDocument.status === 'ready') {\r\n              switch (config.mp4_support) {\r\n                case 'standard':\r\n                  if (assetDocument?.data?.static_renditions?.status === 'ready') {\r\n                    clearInterval(this.pollInterval)\r\n                    this.pollInterval = null\r\n                  }\r\n                  break\r\n                case 'none':\r\n                default:\r\n                  clearInterval(this.pollInterval)\r\n                  this.pollInterval = null\r\n                  break\r\n              }\r\n            }\r\n\r\n            // eslint-disable-next-line camelcase\r\n            const isSigned = assetDocument?.data?.playback_ids[0]?.policy === 'signed'\r\n            this.setState({assetDocument, isSigned, isLoading: false})\r\n\r\n            return of(assetDocument)\r\n          })\r\n        )\r\n        .subscribe()\r\n    }\r\n\r\n    pollMux = () => {\r\n      const assetDocument = this.state.assetDocument\r\n      if (!assetDocument) {\r\n        return\r\n      }\r\n      if (this.pollInterval) {\r\n        return\r\n      }\r\n      this.pollInterval = setInterval(() => {\r\n        getAsset(assetDocument.assetId)\r\n          .then((response) => {\r\n            const props = response.data\r\n\r\n            // TODO: consider a deep comparison on `props` with asset data and only patch only if it's changed\r\n            client\r\n              .patch(assetDocument._id)\r\n              .set({\r\n                status: props.status,\r\n                data: props,\r\n              })\r\n              .commit({returnDocuments: false})\r\n          })\r\n          .catch((error) => {\r\n            this.setState({error})\r\n          })\r\n      }, 2000)\r\n    }\r\n\r\n    handleSetupButtonClicked = (event) => {\r\n      this.setState((prevState) => ({showSetup: !prevState.showStetup}))\r\n    }\r\n\r\n    handleSaveSetup = ({token, secretKey, enableSignedUrls, signingKeyId, signingKeyPrivate}) => {\r\n      cachedSecrets.token = token\r\n      cachedSecrets.secretKey = secretKey\r\n      cachedSecrets.enableSignedUrls = enableSignedUrls\r\n      cachedSecrets.signingKeyId = signingKeyId\r\n      cachedSecrets.signingKeyPrivate = signingKeyPrivate\r\n\r\n      this.setState({\r\n        showSetup: false,\r\n        secrets: cachedSecrets,\r\n        needsSetup: !validateSecrets(cachedSecrets),\r\n      })\r\n    }\r\n\r\n    handleCancelSaveSetup = () => {\r\n      this.setState({showSetup: false})\r\n    }\r\n\r\n    handleOnUploadComplete = (result) => {\r\n      const {onChange} = this.props\r\n      const {_id} = result\r\n      onChange(\r\n        PatchEvent.from([setIfMissing({asset: {_ref: _id}}, []), set({_ref: _id}, ['asset'])])\r\n      )\r\n      this.setState({assetDocument: result.document}, () => {\r\n        this.setupAssetListener()\r\n      })\r\n    }\r\n\r\n    handleRemoveVideoButtonClicked = (event) => {\r\n      event.preventDefault()\r\n      event.stopPropagation()\r\n      this.setState({confirmRemove: true})\r\n    }\r\n\r\n    handleRemoveVideo = () => {\r\n      const {assetDocument} = this.state\r\n      this.setState({isLoading: true})\r\n      const unsetAsset = () => {\r\n        return new Promise((resolve, reject) => {\r\n          this.setState(\r\n            {\r\n              assetDocument: null,\r\n              confirmRemove: false,\r\n              isLoading: false,\r\n            },\r\n            () => {\r\n              if (this.state.deleteOnMuxChecked || this.state.deleteAssetDocumentChecked) {\r\n                return client\r\n                  .patch(this.props.document._id)\r\n                  .unset(['video'])\r\n                  .commit({returnDocuments: false})\r\n                  .then(() => {\r\n                    if (!assetDocument) {\r\n                      return resolve()\r\n                    }\r\n                    return client\r\n                      .delete(assetDocument._id)\r\n                      .then(() => {\r\n                        resolve()\r\n                      })\r\n                      .catch((error) => {\r\n                        reject(error)\r\n                      })\r\n                  })\r\n              }\r\n              return this.props.onChange(PatchEvent.from(unset()))\r\n            }\r\n          )\r\n        })\r\n      }\r\n      return unsetAsset()\r\n        .then(() => {\r\n          if (this.state.deleteOnMuxChecked) {\r\n            return deleteAsset(assetDocument.assetId).catch((error) => {\r\n              this.setState({error})\r\n            })\r\n          }\r\n          return true\r\n        })\r\n        .catch((error) => {\r\n          this.setState({error})\r\n        })\r\n    }\r\n\r\n    handleCancelRemove = (event) => {\r\n      this.setState({\r\n        confirmRemove: false,\r\n        deleteOnMuxChecked: true,\r\n        deleteAssetDocumentChecked: true,\r\n      })\r\n    }\r\n\r\n    handleDeleteOnMuxCheckBoxClicked = (event) => {\r\n      this.setState((prevState) => ({\r\n        deleteOnMuxChecked: !prevState.deleteOnMuxChecked,\r\n      }))\r\n    }\r\n\r\n    handleDeleteAssetDocumentCheckBoxClicked = (event) => {\r\n      this.setState((prevState) => ({\r\n        deleteAssetDocumentChecked: !prevState.deleteAssetDocumentChecked,\r\n      }))\r\n    }\r\n\r\n    handleOpenThumb = (event) => {\r\n      if (!this.videoPlayer.current) {\r\n        return\r\n      }\r\n      const {assetDocument, isSigned} = this.state\r\n      const currentTime = this.videoPlayer.current.getVideoElement().currentTime\r\n      const options = {\r\n        time: assetDocument.thumbTime,\r\n        width: 320,\r\n        height: 320,\r\n        fitMode: 'crop',\r\n        isSigned,\r\n        signingKeyId: cachedSecrets.signingKeyId,\r\n        signingKeyPrivate: cachedSecrets.signingKeyPrivate,\r\n      }\r\n\r\n      const thumb = getPosterSrc(assetDocument.playbackId, options)\r\n      const newThumb = getPosterSrc(assetDocument.playbackId, {...options, time: currentTime})\r\n\r\n      this.setState({thumb, newThumb})\r\n    }\r\n\r\n    handleSetThumbButton = (event) => {\r\n      if (!this.videoPlayer.current) {\r\n        return\r\n      }\r\n\r\n      this.setState({thumbLoading: true})\r\n      const {assetDocument, isSigned} = this.state\r\n      const currentTime = this.videoPlayer.current.getVideoElement().currentTime\r\n      client\r\n        .patch(assetDocument._id)\r\n        .set({\r\n          thumbTime: currentTime,\r\n        })\r\n        .commit({returnDocuments: false})\r\n        .then((response) => {\r\n          const options = {\r\n            time: currentTime,\r\n            width: 320,\r\n            height: 320,\r\n            fitMode: 'crop',\r\n            isSigned,\r\n            signingKeyId: cachedSecrets.signingKeyId,\r\n            signingKeyPrivate: cachedSecrets.signingKeyPrivate,\r\n          }\r\n\r\n          const thumb = getPosterSrc(assetDocument.playbackId, options)\r\n\r\n          this.setState({thumb, thumbLoading: false})\r\n        })\r\n        .catch((error) => {\r\n          this.setState({error, thumbLoading: false})\r\n        })\r\n    }\r\n\r\n    handleErrorClose = (event) => {\r\n      if (event) {\r\n        event.preventDefault()\r\n      }\r\n\r\n      this.setState({\r\n        error: null,\r\n      })\r\n    }\r\n\r\n    handleCloseThumbPreview = (event) => {\r\n      this.setState({thumb: null})\r\n    }\r\n\r\n    handleBrowseButton = (event) => {\r\n      this.setState({showBrowser: true})\r\n    }\r\n\r\n    handleCloseBrowser = (event) => {\r\n      this.setState({showBrowser: false})\r\n    }\r\n\r\n    handleSelectAsset = (asset) => {\r\n      const {onChange} = this.props\r\n\r\n      onChange(\r\n        PatchEvent.from([\r\n          setIfMissing({asset: {_ref: asset._id}}, []),\r\n          set({_ref: asset._id}, ['asset']),\r\n        ])\r\n      )\r\n\r\n      this.setState({showBrowser: false, assetDocument: asset}, () => {\r\n        this.setupAssetListener()\r\n      })\r\n    }\r\n\r\n    handleVideoReadyToPlay = () => {\r\n      this.setState({videoReadyToPlay: true})\r\n    }\r\n\r\n    renderSetup() {\r\n      const {secrets} = this.state\r\n\r\n      return (\r\n        <Dialog\r\n          header=\"Mux API Credentials\"\r\n          width={1}\r\n          onClose={this.handleCancelSaveSetup}\r\n          zOffset={1000}\r\n        >\r\n          <Setup\r\n            secrets={secrets || null}\r\n            onSave={this.handleSaveSetup}\r\n            onCancel={this.handleCancelSaveSetup}\r\n          />\r\n        </Dialog>\r\n      )\r\n    }\r\n\r\n    renderSetupButton() {\r\n      const {isLoading, showSetup, needsSetup} = this.state\r\n      const renderSetup = !isLoading && showSetup\r\n      return (\r\n        <div className={styles.setupButtonContainer}>\r\n          <Button\r\n            tone={needsSetup ? 'critical' : 'positive'}\r\n            mode=\"bleed\"\r\n            onClick={this.handleSetupButtonClicked}\r\n            icon={SetupIcon}\r\n            padding={3}\r\n            radius={3}\r\n            aria-label=\"Set up Mux credentials\"\r\n          />\r\n          {renderSetup && this.renderSetup()}\r\n        </div>\r\n      )\r\n    }\r\n\r\n    renderSetupNotice() {\r\n      const {isLoading, isInitialSetup} = this.state\r\n\r\n      if (isLoading) {\r\n        return null\r\n      }\r\n\r\n      return (\r\n        <Stack padding={4} space={5} style={{backgroundColor: '#efefefef', borderRadius: 3}}>\r\n          <MuxLogo />\r\n          <Stack space={4}>\r\n            {isInitialSetup && (\r\n              <Text>\r\n                Looks like this is the first time you are using the Mux video plugin in this\r\n                dataset. Great!\r\n              </Text>\r\n            )}\r\n            <Text>Before you can upload video, you must set your Mux credentials.</Text>\r\n            <Text>Click the plugin button in the field title to open Setup.</Text>\r\n          </Stack>\r\n        </Stack>\r\n      )\r\n    }\r\n\r\n    // eslint-disable-next-line complexity\r\n    renderAsset() {\r\n      const {assetDocument, isSigned} = this.state\r\n      const renderAsset = !!assetDocument\r\n      if (!renderAsset) {\r\n        return null\r\n      }\r\n      const isSignedAlert = isSigned ? (\r\n        <Card padding={3} radius={2} shadow={1} tone=\"positive\">\r\n          <Text size={1}>This Mux asset is using a signed url.</Text>\r\n        </Card>\r\n      ) : null\r\n      return (\r\n        <Stack space={2} marginBottom={2}>\r\n          {isSignedAlert}\r\n          <Video\r\n            assetDocument={assetDocument}\r\n            ref={this.videoPlayer}\r\n            onReady={this.handleVideoReadyToPlay}\r\n            onCancel={this.handleRemoveVideo}\r\n          />\r\n        </Stack>\r\n      )\r\n    }\r\n\r\n    renderVideoButtons() {\r\n      const {assetDocument, confirmRemove} = this.state\r\n      const {readOnly} = this.props\r\n      if (assetDocument && assetDocument.status === 'ready' && !readOnly) {\r\n        return [\r\n          <Button\r\n            key=\"browse\"\r\n            mode=\"ghost\"\r\n            tone=\"primary\"\r\n            onClick={this.handleBrowseButton}\r\n            text=\"Browse\"\r\n          />,\r\n          <Button\r\n            key=\"thumbnail\"\r\n            mode=\"ghost\"\r\n            tone=\"primary\"\r\n            disabled={this.state.videoReadyToPlay === false}\r\n            onClick={this.handleOpenThumb}\r\n            text=\"Thumbnail\"\r\n          />,\r\n          <Button\r\n            key=\"remove\"\r\n            ref={this.removeVideoButton}\r\n            onClick={confirmRemove ? NOOP : this.handleRemoveVideoButtonClicked}\r\n            mode=\"ghost\"\r\n            tone=\"critical\"\r\n            text=\"Remove\"\r\n          />,\r\n        ]\r\n      }\r\n      return null\r\n    }\r\n\r\n    renderBrowser() {\r\n      return (\r\n        <FullscreenDialog title=\"Select video\" onClose={this.handleCloseBrowser} isOpen>\r\n          <SelectAsset onSelect={this.handleSelectAsset} />\r\n        </FullscreenDialog>\r\n      )\r\n    }\r\n\r\n    renderError() {\r\n      const {error} = this.state\r\n      if (!error) {\r\n        return null\r\n      }\r\n      return (\r\n        <Dialog header=\"Error\" onClose={this.handleErrorClose}>\r\n          <DialogContent size=\"small\">{error.message}</DialogContent>\r\n        </Dialog>\r\n      )\r\n    }\r\n\r\n    render() {\r\n      const {type, level, markers} = this.props\r\n      const {\r\n        isLoading,\r\n        secrets,\r\n        hasFocus,\r\n        needsSetup,\r\n        error,\r\n        showBrowser,\r\n        confirmRemove,\r\n        thumb,\r\n        assetDocument,\r\n      } = this.state\r\n\r\n      const cssAspectRatio = assetDocument?.data?.aspect_ratio?.split(':')?.join('/') || 'auto'\r\n\r\n      return (\r\n        <ThemeProvider theme={studioTheme}>\r\n          <Box style={{position: 'relative'}}>\r\n            <Flex align=\"center\" justify=\"space-between\">\r\n              <FormField\r\n                label={type.title}\r\n                markers={markers}\r\n                description={type.description}\r\n                level={level}\r\n                className={styles.formField}\r\n              />\r\n              {this.renderSetupButton()}\r\n            </Flex>\r\n\r\n            {isLoading === 'secrets' && (\r\n              <Box marginBottom={2}>\r\n                <Inline align=\"center\" space={2}>\r\n                  <Spinner inline />\r\n                  <Text size={1}>Fetching credentials</Text>\r\n                </Inline>\r\n              </Box>\r\n            )}\r\n\r\n            {needsSetup && this.renderSetupNotice()}\r\n\r\n            {!needsSetup && (\r\n              <Uploader\r\n                buttons={this.renderVideoButtons()}\r\n                hasFocus={hasFocus}\r\n                // eslint-disable-next-line react/jsx-handler-names\r\n                onBlur={this.blur}\r\n                // eslint-disable-next-line react/jsx-handler-names\r\n                onFocus={this.focus}\r\n                onSetupButtonClicked={this.handleSetupButtonClicked}\r\n                onUploadComplete={this.handleOnUploadComplete}\r\n                secrets={secrets}\r\n                onBrowse={this.handleBrowseButton}\r\n              >\r\n                {this.renderAsset()}\r\n              </Uploader>\r\n            )}\r\n\r\n            {thumb && (\r\n              <Dialog header=\"Thumbnail\" zOffset={1000} onClose={this.handleCloseThumbPreview}>\r\n                <Stack space={3} padding={3}>\r\n                  <Stack space={3}>\r\n                    <Stack space={2}>\r\n                      <Text size={1} weight=\"semibold\">\r\n                        Current:\r\n                      </Text>\r\n                      <img\r\n                        style={{\r\n                          maxWidth: '100%',\r\n                          borderRadius: '0.1875rem',\r\n                          display: 'block',\r\n                          aspectRatio: cssAspectRatio,\r\n                        }}\r\n                        src={this.state.thumb}\r\n                        width={400}\r\n                      />\r\n                    </Stack>\r\n                    <Stack space={2}>\r\n                      <Text size={1} weight=\"semibold\">\r\n                        New:\r\n                      </Text>\r\n                      <img\r\n                        style={{\r\n                          maxWidth: '100%',\r\n                          borderRadius: '0.1875rem',\r\n                          display: 'block',\r\n                          aspectRatio: cssAspectRatio,\r\n                        }}\r\n                        src={this.state.newThumb}\r\n                        width={400}\r\n                      />\r\n                    </Stack>\r\n                  </Stack>\r\n                  <Button\r\n                    key=\"thumbnail\"\r\n                    mode=\"ghost\"\r\n                    tone=\"primary\"\r\n                    disabled={this.state.videoReadyToPlay === false}\r\n                    onClick={this.handleSetThumbButton}\r\n                    loading={this.state.thumbLoading}\r\n                    text=\"Set new thumbnail\"\r\n                  />\r\n                </Stack>\r\n              </Dialog>\r\n            )}\r\n\r\n            {showBrowser && this.renderBrowser()}\r\n\r\n            {confirmRemove && (\r\n              <Dialog header=\"Remove video\" zOffset={1000} onClose={this.handleCancelRemove}>\r\n                <Box padding={4}>\r\n                  <Stack space={3}>\r\n                    <Flex align=\"center\">\r\n                      <Checkbox\r\n                        checked={this.state.deleteOnMuxChecked}\r\n                        onChange={this.handleDeleteOnMuxCheckBoxClicked}\r\n                      />\r\n                      <Text style={{margin: '0 10px'}}>Delete asset on Mux</Text>\r\n                    </Flex>\r\n                    <Flex align=\"center\">\r\n                      <Checkbox\r\n                        disabled={this.state.deleteOnMuxChecked}\r\n                        checked={\r\n                          this.state.deleteOnMuxChecked || this.state.deleteAssetDocumentChecked\r\n                        }\r\n                        onChange={this.handleDeleteAssetDocumentCheckBoxClicked}\r\n                      />\r\n                      <Text style={{margin: '0 10px'}}>Delete video from dataset</Text>\r\n                    </Flex>\r\n                    <Grid columns={2} gap={2}>\r\n                      <Button\r\n                        mode=\"ghost\"\r\n                        tone=\"default\"\r\n                        text=\"Cancel\"\r\n                        onClick={this.handleCancelRemove}\r\n                        loading={!!isLoading}\r\n                      />\r\n                      <Button\r\n                        mode=\"default\"\r\n                        tone=\"critical\"\r\n                        text=\"Remove\"\r\n                        onClick={this.handleRemoveVideo}\r\n                        loading={!!isLoading}\r\n                      />\r\n                    </Grid>\r\n                  </Stack>\r\n                </Box>\r\n              </Dialog>\r\n            )}\r\n\r\n            {error && this.renderError()}\r\n          </Box>\r\n        </ThemeProvider>\r\n      )\r\n    }\r\n  }\r\n)\r\n"],"file":"Input.js"}