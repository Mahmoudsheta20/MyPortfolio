{"version":3,"sources":["../../src/components/Video.js"],"names":["NOOP","propTypes","assetDocument","PropTypes","object","isRequired","autoload","bool","onCancel","func","onReady","MuxVideo","Component","constructor","props","React","createRef","event","setState","showControls","hls","startLoad","state","storyboardUrl","posterUrl","source","isLoading","error","isDeletedOnMux","isPreparingStaticRenditions","secrets","playRef","muteRef","getDerivedStateFromProps","nextProps","status","data","static_renditions","componentDidMount","video","style","document","createElement","innerHTML","current","shadowRoot","appendChild","cloneNode","then","componentDidUpdate","prevProps","prevState","previousVideo","playbackId","newVideo","resolveSourceAndPoster","src","attachVideo","destroy","options","isSigned","playback_ids","policy","signingKeyId","signingKeyPrivate","getVideoElement","Hls","isSupported","autoStartLoad","loadSource","attachMedia","on","Events","MANIFEST_PARSED","e","videoContainer","display","ERROR","type","ErrorTypes","NETWORK_ERROR","assetId","response","catch","err","message","match","console","canPlayType","addEventListener","render","styles","progressBar","uploadCancelButton","handleCancelButtonClicked","handleVideoClick","background","position","top","left","color","defaultProps","undefined"],"mappings":"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","sourcesContent":["import {Box, Card, Stack, Text} from '@sanity/ui'\r\nimport Hls from 'hls.js'\r\nimport 'media-chrome'\r\nimport Button from 'part:@sanity/components/buttons/default'\r\nimport ProgressBar from 'part:@sanity/components/progress/bar'\r\nimport PropTypes from 'prop-types'\r\nimport React, {Component} from 'react'\r\nimport {getAsset} from '../actions/assets'\r\nimport {fetchSecrets} from '../actions/secrets'\r\nimport getPosterSrc from '../util/getPosterSrc'\r\nimport getStoryboardSrc from '../util/getStoryboardSrc'\r\nimport getVideoSrc from '../util/getVideoSrc'\r\nimport styles from './Video.css'\r\n\r\nconst NOOP = () => {\r\n  /* intentional noop */\r\n}\r\n\r\nconst propTypes = {\r\n  // eslint-disable-next-line react/forbid-prop-types\r\n  assetDocument: PropTypes.object.isRequired,\r\n  autoload: PropTypes.bool,\r\n  onCancel: PropTypes.func,\r\n  onReady: PropTypes.func,\r\n}\r\n\r\nclass MuxVideo extends Component {\r\n  videoContainer = React.createRef()\r\n  hls = null\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      storyboardUrl: null,\r\n      posterUrl: null,\r\n      source: null,\r\n      isLoading: true,\r\n      error: null,\r\n      isDeletedOnMux: false,\r\n      isPreparingStaticRenditions: false,\r\n      secrets: null,\r\n    }\r\n    this.playRef = React.createRef()\r\n    this.muteRef = React.createRef()\r\n  }\r\n\r\n  // eslint-disable-next-line complexity\r\n  static getDerivedStateFromProps(nextProps) {\r\n    let isLoading = true\r\n    let isPreparingStaticRenditions = false\r\n    const {assetDocument} = nextProps\r\n\r\n    if (assetDocument && assetDocument.status === 'preparing') {\r\n      isLoading = 'Preparing the video'\r\n    }\r\n    if (assetDocument && assetDocument.status === 'waiting_for_upload') {\r\n      isLoading = 'Waiting for upload to start'\r\n    }\r\n    if (assetDocument && assetDocument.status === 'waiting') {\r\n      isLoading = 'Processing upload'\r\n    }\r\n    if (assetDocument && assetDocument.status === 'ready') {\r\n      isLoading = false\r\n    }\r\n    if (assetDocument && typeof assetDocument.status === 'undefined') {\r\n      isLoading = false\r\n    }\r\n    if (assetDocument?.data?.static_renditions?.status === 'preparing') {\r\n      isPreparingStaticRenditions = true\r\n    }\r\n    if (assetDocument?.data?.static_renditions?.status === 'ready') {\r\n      isPreparingStaticRenditions = false\r\n    }\r\n    return {\r\n      isLoading,\r\n      isPreparingStaticRenditions,\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.video = React.createRef()\r\n\r\n    const style = document.createElement('style')\r\n    style.innerHTML = 'button svg { vertical-align: middle; }'\r\n\r\n    if (this.playRef?.current?.shadowRoot) {\r\n      this.playRef.current.shadowRoot.appendChild(style)\r\n    }\r\n    if (this.muteRef?.current?.shadowRoot) {\r\n      this.muteRef.current.shadowRoot.appendChild(style.cloneNode(true))\r\n    }\r\n\r\n    this.setState(MuxVideo.getDerivedStateFromProps(this.props))\r\n    fetchSecrets().then(({secrets}) => this.setState({secrets}))\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    const previousVideo = prevProps.assetDocument.playbackId\r\n    const newVideo = this.props.assetDocument.playbackId\r\n\r\n    if (\r\n      !this.state.isLoading &&\r\n      this.state.secrets &&\r\n      (this.state.source === null || previousVideo !== newVideo)\r\n    ) {\r\n      this.resolveSourceAndPoster(this.props.assetDocument)\r\n    }\r\n\r\n    if (this.state.source !== null && this.video.current && !this.video.current.src) {\r\n      // eslint-disable-next-line react/no-did-update-set-state\r\n      this.setState({error: null})\r\n      this.attachVideo()\r\n    }\r\n\r\n    if (this.state.source !== null && this.state.source !== prevState.source) {\r\n      // eslint-disable-next-line react/no-did-update-set-state\r\n      this.setState({error: null, showControls: false})\r\n      if (this.hls) {\r\n        this.hls.destroy()\r\n      }\r\n      this.attachVideo()\r\n    }\r\n  }\r\n\r\n  resolveSourceAndPoster(assetDocument) {\r\n    const playbackId = assetDocument.playbackId\r\n    const options = {\r\n      isSigned: assetDocument.data.playback_ids[0].policy === 'signed',\r\n      signingKeyId: this.state.secrets.signingKeyId || null,\r\n      signingKeyPrivate: this.state.secrets.signingKeyPrivate || null,\r\n    }\r\n\r\n    const source = getVideoSrc(playbackId, options)\r\n    const posterUrl = getPosterSrc(playbackId, options)\r\n    const storyboardUrl = getStoryboardSrc(playbackId, options)\r\n    this.setState({source, posterUrl, storyboardUrl})\r\n  }\r\n\r\n  getVideoElement() {\r\n    return this.video && this.video.current\r\n  }\r\n\r\n  attachVideo() {\r\n    const {assetDocument, autoload} = this.props\r\n\r\n    if (Hls.isSupported()) {\r\n      this.hls = new Hls({autoStartLoad: autoload})\r\n      this.hls.loadSource(this.state.source)\r\n      this.hls.attachMedia(this.video.current)\r\n      this.hls.on(Hls.Events.MANIFEST_PARSED, (e) => {\r\n        if (this.videoContainer.current) {\r\n          this.videoContainer.current.style.display = 'block'\r\n        }\r\n        if (this.props.onReady) {\r\n          this.props.onReady()\r\n        }\r\n      })\r\n      this.hls.on(Hls.Events.ERROR, (event, data) => {\r\n        switch (data.type) {\r\n          case Hls.ErrorTypes.NETWORK_ERROR:\r\n            if (this.videoContainer.current) {\r\n              this.videoContainer.current.style.display = 'none'\r\n            }\r\n            this.setState({error: data})\r\n            getAsset(assetDocument.assetId)\r\n              .then((response) => {\r\n                this.setState({isDeletedOnMux: false})\r\n              })\r\n              .catch((err) => {\r\n                if (err.message.match(/404/)) {\r\n                  this.setState({isDeletedOnMux: true})\r\n                  return\r\n                }\r\n                console.error(data, err) // eslint-disable-line no-console\r\n              })\r\n            break\r\n          default:\r\n            console.error(data) // eslint-disable-line no-console\r\n        }\r\n      })\r\n    } else if (this.video.current.canPlayType('application/vnd.apple.mpegurl')) {\r\n      this.video.current.src = this.state.source\r\n      this.video.current.addEventListener('loadedmetadata', () => {\r\n        this.hls.loadSource(this.state.source)\r\n        this.hls.attachMedia(this.video.current)\r\n      })\r\n    }\r\n  }\r\n\r\n  handleVideoClick = (event) => {\r\n    this.setState({showControls: true})\r\n    this.hls.startLoad(0)\r\n    if (this.props.onReady) {\r\n      this.props.onReady(event)\r\n    }\r\n  }\r\n\r\n  handleCancelButtonClicked = (event) => {\r\n    if (this.props.onCancel) {\r\n      this.props.onCancel(event)\r\n    }\r\n  }\r\n\r\n  // eslint-disable-next-line complexity\r\n  render() {\r\n    const {posterUrl, isLoading, error} = this.state\r\n    const {assetDocument, autoload} = this.props\r\n    if (!assetDocument || !assetDocument.status) {\r\n      return null\r\n    }\r\n\r\n    if (isLoading) {\r\n      return (\r\n        <div>\r\n          <div className={styles.progressBar}>\r\n            <ProgressBar\r\n              percent={100}\r\n              text={(isLoading !== true && isLoading) || 'Waiting for Mux to complete the file'}\r\n              isInProgress\r\n              showPercent\r\n              animation\r\n              color=\"primary\"\r\n            />\r\n          </div>\r\n          <div className={styles.uploadCancelButton}>\r\n            <Button onClick={this.handleCancelButtonClicked}>Cancel</Button>\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    const showControls = autoload || this.state.showControls\r\n\r\n    return (\r\n      <div ref={this.videoContainer} className={styles.videoContainer}>\r\n        <media-controller>\r\n          <video\r\n            onClick={autoload ? NOOP : this.handleVideoClick}\r\n            ref={this.video}\r\n            poster={posterUrl}\r\n            slot=\"media\"\r\n            crossOrigin=\"anonomous\"\r\n          >\r\n            {this.state.storyboardUrl && (\r\n              <track label=\"thumbnails\" default kind=\"metadata\" src={this.state.storyboardUrl} />\r\n            )}\r\n          </video>\r\n\r\n          {showControls && (\r\n            <media-control-bar>\r\n              <media-play-button ref={this.playRef} />\r\n              <media-mute-button ref={this.muteRef} />\r\n              {/* The media volume range is causing an error to be logged in the studio: Failed to construct 'CustomElement': The result must not have attributes */}\r\n              {/* <media-volume-range /> */}\r\n              <media-progress-range />\r\n            </media-control-bar>\r\n          )}\r\n        </media-controller>\r\n        {error && (\r\n          <Card padding={3} radius={2} shadow={1} tone=\"critical\" marginTop={2}>\r\n            <Stack space={2}>\r\n              <Text size={1}>There was an error loading this video ({error.type}).</Text>\r\n              {this.state.isDeletedOnMux && <Text size={1}>The video is deleted on Mux</Text>}\r\n            </Stack>\r\n          </Card>\r\n        )}\r\n\r\n        {this.state.isPreparingStaticRenditions && (\r\n          <Card\r\n            padding={2}\r\n            radius={1}\r\n            style={{\r\n              background: 'var(--card-fg-color)',\r\n              position: 'absolute',\r\n              top: '0.5em',\r\n              left: '0.5em',\r\n            }}\r\n          >\r\n            <Text size={1} style={{color: 'var(--card-bg-color)'}}>\r\n              MUX is preparing static renditions, please stand by\r\n            </Text>\r\n          </Card>\r\n        )}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nMuxVideo.propTypes = propTypes\r\n\r\nMuxVideo.defaultProps = {\r\n  autoload: true,\r\n  onCancel: undefined,\r\n  onReady: undefined,\r\n}\r\n\r\nexport default MuxVideo\r\n"],"file":"Video.js"}